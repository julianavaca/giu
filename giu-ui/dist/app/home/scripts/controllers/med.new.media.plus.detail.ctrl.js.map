{"version":3,"sources":["app/home/scripts/controllers/med.new.media.plus.detail.ctrl.js"],"names":[],"mappings":"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","file":"app/home/scripts/controllers/med.new.media.plus.detail.ctrl.js","sourcesContent":["'use strict';\nimport WizardTab from '../med.wizard.tab.js';\n\nexport default class NewMediaPlusDetailCtrl extends WizardTab {\n\n  /*@ngInject*/\n  constructor($injector, $state){\n\n    super(\n      {\n        injector:$injector,\n        endpoint:'mediaMaterials',\n        key:'id',\n        backToState:'newMedia.summary',\n        successTitle: 'media.edit.alert.success.title',\n        successMessage: 'media.edit.alert.success.message',\n        successCreateMessage: 'media.edit.alert.create.success.message',\n        successEditMessage: 'media.edit.alert.success.message',\n        errorTitle: 'media.edit.alert.error',\n        executeGet: false,\n        params: $state.params,\n        entityDependencies: [\n          {api: 'photoTypes', loading: 'isLoadingPhotoTypes', model: 'photoTypes'},\n          {api: 'materialTypesResource', loading: 'isLoadingMaterialTypesResource', model: 'materialTypes'},\n          {api: 'mediaFormatResource', loading: 'isLoadingMediaFormatResource', model: 'mediaFormat'},\n          {api: 'videoStandards', loading: 'isLoadingStandard', model: 'standards'},\n          {api: 'editedby', loading: 'isLoadingEditedby', model: 'editedBy'}\n        ]\n      }\n    );\n    this.setOfTapes = {};\n    this.setOfTapes.partNumber = 1;\n    this.setOfTapes.partsTotal = 1;\n    this.entity = {standard: {id: 'NTSC'} };\n    //Todo: revisar esto this.warning = false;\n    //Todo: revisar esto this.newMediaService.invalidPlusDetail = false;\n  }\n  \n  setStandardFrame(item){\n   //Todo:No deberia usar el \"console.log\" console.log(item.code);\n  }\n\n  isValidsetOfTapes(){\n    return Number.parseInt(this.setOfTapes.partNumber) <= Number.parseInt(this.setOfTapes.partsTotal);\n  }\n  \n  isValidTapSet(){\n    if (this.setOfTapes.partsTotal < 2) {\n      return true;\n    }\n     return typeof this.setOfTapes.currentTapeSet.id !== 'undefined'\n  }\n\n  nextStep(){\n    let id=this.entity.standard.id;\n    let standard=this.standards.find((it)=>it.id===id);\n    this.newMediaService.setToModel('standard', standard);\n    let promise = this.api.setOfTapesCurrent.update({'id': this.newMediaService.mediaId}, this.setOfTapes).$promise;\n    promise.then((response) => {\n      this.$log.info('then', response);\n\n      this.$log.info('back to state',this.backToState.state, this.backToState.params);\n\n      this.alertService.success(\n        {\n          title:this.translate(this.successTitle),\n          message:this._isNew() ? this.translate(this.successCreateMessage) : this.translate(this.successEditMessage)\n        }\n      );\n      this.newMediaService.invalidPlusDetail = false;\n      this.newMediaService.nextStep();\n\n    }, (err) => {\n\n      if(err.status === 422){\n        err.data.forEach(data => {\n          form[data.field].$error = {backendError: true};\n          form[data.field].backenMessage = data.message;\n        });\n      } else {\n        this.alertService.error({\n          title: this.translate(this.errorTitle),\n          message: err.data.message\n        });\n      }\n    });\n\n  }\n\n  updateTechnicalState(){\n\n    let aspectRatioId = this.entity.aspectRatio.id;\n    let aspectRatio = this.getFromModel('aspectRatios').find(function(aspectRatio){\n      return aspectRatio.id == aspectRatioId;\n    });\n    if(aspectRatio != undefined && aspectRatio.technicalState != null && aspectRatio.technicalState != undefined){\n      this.getFromModel(\"technicalState\").id = aspectRatio.technicalState.id;\n      this.entity.technicalState = {'id': aspectRatio.technicalState.id};\n      this.warning = true;\n    } else {\n      this.getFromModel(\"technicalState\").id = this.getFromModel(\"defaultTechnicalStateId\");\n      delete this.entity.technicalState;\n      this.warning = false;\n    }\n\n  }\n\n  saveAndNextStep(form){\n    if(this.entity.originMedia != undefined && this.entity.originMedia.selected != undefined){\n      delete this.entity.originMedia.selected;\n    }\n    if(this.entity.rootMedia != undefined && this.entity.rootMedia.selected != undefined){\n      delete this.entity.rootMedia.selected;\n    }\n    super.saveAndNextStep(form);\n  }\n\n  saveAndExit(form){\n    if(this.entity.originMedia != undefined && this.entity.originMedia.selected != undefined){\n      delete this.entity.originMedia.selected;\n    }\n    if(this.entity.rootMedia != undefined && this.entity.rootMedia.selected != undefined){\n      delete this.entity.rootMedia.selected;\n    }\n    super.saveAndExit(form);\n  }\n\n}\n"],"sourceRoot":"/source/"}