{"version":3,"sources":["app/home/scripts/controllers/med.search.media.ctrl.js"],"names":[],"mappings":"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","file":"app/home/scripts/controllers/med.search.media.ctrl.js","sourcesContent":["/**\n * Created by julian on 16/02/16.\n */\n\"use strict\";\n\nexport default class SearchMediaCtrl{\n\n  //TODO: esto no está usando correctamente el módulo CRUD, modificar para que sea así\n  /*@ngInject*/\n  constructor($state, api, alertService, translateService) {\n    this.state = $state;\n    this.api = api;\n    this.alertService = alertService;\n    this.translateService = translateService;\n    this.disable = true;\n\n    // Intentamos completar los campos si tenemos la info\n    this.entity = {};\n    this.disableField();\n    this.isValidDate = true;\n    this.isValidRange = true;\n    this._init();\n  }\n\n  checkDateValidity(from, to) {\n    if (from != undefined && to != undefined && from.getTime() > to.getTime()) {\n      this.isValidDate = false;\n      return false;\n    } else {\n      this.isValidDate = true;\n      return true;\n    }\n  }\n\n  updateFeeds(that,item){\n    if(that.entity.network && item){\n      if(that.entity.network.id === item.id){\n        return;\n      }\n    }\n    that.entity.feed = null;\n    if(!item){\n      that.feeds = that.originalFeeds;\n      that.paramFeed = {};\n      return;\n    }else{\n      that.paramFeed = {networkId: item.id};\n    }\n  }\n\n  checkChapterValidity(from, to) {\n    if (parseInt(from) > parseInt(to)) {\n      this.isValidRange = false;\n      return false;\n    } else {\n      this.isValidRange = true;\n      return true;\n    }\n  }\n\n  _init() {\n    this.getDetailData('feeds').$promise.then((response) =>{\n      this.originalFeeds = response.content;\n      this.feeds = angular.copy(this.originalFeeds);\n    });\n  }\n\n  getParamValue(paramName) {\n    return this.state.params[paramName];\n  }\n\n  isFormCompleted() {\n    let valid = false;\n    for (var data in this.entity) {\n      if (this.entity[data] !== undefined && this.entity[data] != \"\" && this.entity[data] != null) {\n        valid = true;\n      }\n    }\n    return valid && this.entity && Object.getOwnPropertyNames(this.entity).length > 0;\n  }\n\n  makeSearch() {\n    let self = this;\n    if (this.isFormCompleted() && this.isValidDate && this.isValidRange) {\n      if (this.entity.createdBy) {\n        this.entity.createdBy = this.entity.createdBy.username;\n      }\n      if (this.entity.mediaFormat) {\n        this.entity.mediaFormat = this.entity.mediaFormat.id;\n      }\n      if (this.entity.mediaType) {\n        this.entity.mediaType = this.entity.mediaType.id;\n      }\n      if (this.entity.network) {\n        this.entity.network = this.entity.network.id;\n      }\n      if (this.entity.feed) {\n        this.entity.feed = this.entity.feed.id;\n      }\n      if (this.entity.materialType) {\n        this.entity.materialType = this.entity.materialType.id;\n      }\n      this._goTo('searchResults');\n    } else {\n      this.alertService.error({\n        title: self.filter('translate')('generic.edit.alert.error'),\n        message: self.filter('translate')('generic.med.search.alert.error.message')\n      });\n    }\n  }\n\n  _goTo() {\n    this._parseDates();\n    this.state.go('searchResults', this.entity);\n  }\n\n  _parseDates(){\n    this.entity.createdOnTo = this._parseDate(this.entity.createdOnTo);\n    this.entity.createdOnFrom = this._parseDate(this.entity.createdOnFrom);\n  }\n\n  _parseDate(date){\n    if(typeof date !== 'undefined'){\n      return date.toISOString();\n    }\n    return undefined;\n  }\n\n  clearForm() {\n    this.entity = {};\n    this.entity.createdBy = null;\n    this.entity.mediaFormat = null;\n    this.entity.mediaType = null;\n    this.entity.network = null;\n    this.entity.feed = null;\n    this.entity.materialType = null;\n  }\n\n  getDetailData(endpoint, params) {\n    this.isLoading = true;\n    this.response = this.api[endpoint].get(params);\n\n    this.response.$promise.then(() => {\n\n      this.isLoading = false;\n\n    }, () => this.isLoading = false);\n\n    return this.response;\n  }\n\n  disableField() {\n    if (this.entity.materialId === undefined || this.entity.materialId == '') {\n      this.disable = true;\n    } else {\n      this.disable = false;\n    }\n  }\n\n\n  expressionCreateBy(item) {\n    return item.username;\n  }\n\n  conditionCreateBy(item, query) {\n    return item.username.indexOf(query.toUpperCase()) > -1;\n  }\n\n  expression(item) {\n    return item.id + ' - ' + item.description;\n  }\n  \n  condition(item, query){\n    if (query == null){\n      query = \"\"\n    }\n    return item.id.indexOf(query.toUpperCase()) > -1 || item.description.indexOf(query.toUpperCase()) > -1;\n  }\n\n  updateChapterTo(){\n    if(this.entity.fromChapter){\n      this.entity.toChapter = this.entity.fromChapter;\n    }\n  }\n}\n"],"sourceRoot":"/source/"}