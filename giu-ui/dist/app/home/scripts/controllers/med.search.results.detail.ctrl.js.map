{"version":3,"sources":["app/home/scripts/controllers/med.search.results.detail.ctrl.js"],"names":[],"mappings":"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","file":"app/home/scripts/controllers/med.search.results.detail.ctrl.js","sourcesContent":["'use strict';\nimport Saveable from 'module-crud-ui/app/scripts/crud.saveable.js';\n/* global angular */\n\nexport default class SearchResultsDetailCtrl extends Saveable {\n\n  /*@ngInject*/\n  constructor($injector,\n              $state,\n              translateService,\n              alertService,\n              $filter,\n              $mdDialog) {\n\n    super(\n      {\n        injector: $injector,\n        endpoint: 'mediaMaterials',\n        key: 'id',\n        backToState: '.',\n        successTitle: 'media.edit.alert.success.title',\n        successMessage: 'media.edit.alert.success.message',\n        successCreateMessage: 'media.edit.alert.create.success.message',\n        successEditMessage: 'media.edit.alert.success.message',\n        errorTitle: 'media.edit.alert.error',\n        executeGet: false,\n        params: $state.params,\n        entityDependenciesExecuteGet: false,\n        entityDependencies: [\n          {api: 'photoTypes', loading: 'isLoading', model: 'phototypes'},\n          {api: 'videoStandards', loading: 'isLoading', model: 'videostandards'},\n          {api: 'aspectsRatio', loading: 'isLoading', model: 'aspectsratio', params: {'id': $state.params.id}},\n          {api: 'technicalsState', loading: 'isLoading', model: 'technicalStatusList'},\n          {api: 'editors', loading: 'isLoading', model: 'editedByList'}\n        ]\n      }\n    );\n\n    this.alertService = alertService;\n    this.filter = $filter;\n    this.state = $state;\n    this.translateService = translateService;\n    this.mdDialog = $mdDialog;\n    this.materialEditShow = {value: false};\n    this.isVirtualSegment = true;\n    this._load();\n  }\n\n  _load() {\n    if (!this.state.params.id) {\n      return;\n    }\n    this._getResource();\n    this.audit = {\n      enabled: this.mediaDetail && this.mediaDetail.audit,\n      isRemote: false,\n      entity: this.entity\n    };\n    this.actions = [\n      {\n        roles: 'MEDR,MMMR,MMMU,MVER,MPTR',\n        tooltip: this.translateService.translate('tooltip.edit'),\n        icon: 'edit',\n        action: () => {\n          this.editMaterial();\n        },\n        show: this.materialEditShow\n      }\n    ];\n    this.contextMenu = [\n      {\n        label: this.translateService.translate('med.materials.details'),\n        action: () => {\n          this.state.go('materialDetail', {\n            'materialId': this.entity.material.id,\n            chapterId: this.entity.material.chapter.id\n          }, {reload: true});\n        }\n      },\n      {\n        label: this.translateService.translate('results.detail.material.programming'),\n        action: () => {\n          this.goDailyprogramming();\n        }\n      }\n    ];\n    this.collapsible = {\n      isEnabled: true,\n      isCollapsed: false,\n      id: 'searchResultsDetailMaterialCtrl'\n    };\n  }\n\n  _getResource() {\n    this.isLoading = true;\n    this\n      .get()\n      .$promise\n      .then(\n        (response) => {\n          this.isVirtualSegment = response.isVirtualSegment;\n          this.materialEditShow.value = response.isEnable;\n          this.audit.enabled = response && response.audit;//this.mediaDetail && this.mediaDetail.audit;\n          this.isLoading = false;\n          this._getEntityDependencies();\n        },\n        () => {\n          this.isLoading = false;\n        }\n      );\n  }\n\n  _getEntityDependencies() {\n    let self = this;\n    this.entityDependencies.forEach(\n      it => {\n        self.api[it.api].get(it.params).$promise.then(response => {\n          self[it.model] = response.content;\n          if (it.api === 'technicalsState') {\n            self.etcAnnulled = self.searchAnnulled(response.content, self.entity.technicalState);\n          }\n          if (it.api === 'aspectsRatio' && self.entity.aspectRatio !== null) {\n            self.aspectRatioAnnulled = self.searchAnnulled(response.content, self.entity.aspectRatio);\n          }\n        });\n      });\n  }\n\n  searchAnnulled(activeList, currentObj) {\n    let annulled = activeList.find(tsl => tsl.id === currentObj.id);\n    if (!annulled) {\n      return angular.copy(currentObj);\n    }\n    return undefined;\n  }\n\n  save(form) {\n    this.validate(form);\n    this.selectStateValueEtc();\n    if (this.entity.parentMedia) {\n      delete this.entity.parentMedia.selected;\n      if(this.entity.parentMedia.id == \"\"){\n        this.entity.parentMedia = null;\n      }\n\n    }\n    this.isLoading = true;\n    var promise = super.save(form);\n    if (promise !== undefined) {\n      promise.then(() => {\n          this._reload();\n        }\n      );\n    }\n    \n  }\n\n  _reload() {\n    this.state.go(this.state.current, {}, {reload: true});\n  }\n\n  validate(form) {\n    if (!this.entity.aspectRatio && !this.entity.hasAspectRatio) {\n      this.entity.aspectRatio = null;\n    }\n  }\n\n  copy(value) {\n    return angular.copy(value);\n  }\n\n  getItemById(list, value) {\n    return list.filter((obj)=> {\n      return obj.id == value;\n    });\n  }\n\n  goToParentMedia() {\n    if (this.entity.parentMedia.id) {\n      let parentParams = {\n        mediaFormat: this.entity.parentMedia.format,\n        mediaType: this.entity.parentMedia.type,\n        mediaId: this.entity.parentMedia.number\n      };\n      this.state.go('searchResults', parentParams);\n    }\n  }\n\n  updateTechnicalState() {\n    let aspectRatioId = this.entity.aspectRatio.id;\n    let aspectRatio = this.aspectsratio.find(function (aspectRatio) {\n      return aspectRatio.id == aspectRatioId;\n    });\n    if (!aspectRatio) {\n      return false;\n    }\n    if (aspectRatio.technicalState !== null && aspectRatio.technicalState !== undefined) {\n      this.entity.technicalState.id = aspectRatio.technicalState.id;\n    }\n  }\n\n  goDailyprogramming() {\n    let params = {\n      materialId: this.entity.material.id,\n      chapterId: this.entity.material.chapter.id\n    };\n    this.state.go('materialProgramming', params);\n  }\n\n  cancelMaterial() {\n    this.materialEdit = !this.materialEdit;\n    this.materialEditShow.value = true;\n    this.entity = this.oldValue;\n  }\n\n  changeEtc(ev) {\n    if (this.etcAnnulled) {\n      if (this.entity.technicalState.id === this.etcAnnulled.id) {\n        this.entity.technicalState.description = this.etcAnnulled.description;\n        return false;\n      }\n    }\n    this.entity.technicalState.description = this.getItemById(\n      this.technicalStatusList, this.entity.technicalState.id)[0].description;\n    this.openAddNote(ev);\n  }\n\n  selectStateValueEtc(){\n    this.entity.technicalState.validState = this.getItemById(\n      this.technicalStatusList, this.entity.technicalState.id)[0].validState;\n  }\n\n  openAddNote(ev) {\n    let self = this;\n    this.width = 50;\n    this.mdDialog\n      .show(\n        {\n          controller: ($scope, $mdDialog) => {\n            $scope.vm = self;\n          },\n          templateUrl: 'home/views/med.etc.add.note.html',\n          parent: angular.element(document.body),\n          targetEvent: ev,\n          clickOutsideToClose: true\n        }\n      );\n  }\n\n  submit($event) {\n    this.closeAddNote($event);\n  }\n\n  cancelAddNote($event) {\n    this.notes = undefined;\n    this.closeAddNote($event);\n  }\n\n  closeAddNote($event) {\n    this.mdDialog.hide();\n    $event.preventDefault();\n  }\n\n  editMaterial() {\n    this.materialEdit = !this.materialEdit;\n    this.oldValue = this.copy(this.entity);\n    this.materialEditShow.value = !this.materialEditShow.value;\n  }\n\n  shouldWarning(){\n    if(!this.aspectsratio){\n      return false;\n    }\n    if(!this.entity.aspectRatio){\n      return false;\n    }\n\n    let aspectRatio = this.aspectsratio.find(aspectRatio => aspectRatio.id == this.entity.aspectRatio.id);\n    if(!aspectRatio){\n      return false;\n    }\n    return aspectRatio.technicalState;\n  }\n}\n"],"sourceRoot":"/source/"}