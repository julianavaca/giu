{"version":3,"sources":["app/home/scripts/controllers/med.new.media.rating.ctrl.js"],"names":[],"mappings":"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","file":"app/home/scripts/controllers/med.new.media.rating.ctrl.js","sourcesContent":["'use strict';\nimport WizardTab from '../med.wizard.tab.js';\n\nexport default class NewMediaRatingCtrl extends WizardTab {\n\n  /*@ngInject*/\n  constructor($injector,api, $state,translateService,$filter,authorityService){\n\n    super(\n      {\n        injector:$injector,\n        endpoint:'mediaRatings',\n        key:'id',\n        backToState:'newMedia.summary',\n        successTitle: 'media.edit.alert.success.title',\n        successMessage: 'media.edit.alert.success.message',\n        successCreateMessage: 'media.edit.alert.create.success.message',\n        successEditMessage: 'media.edit.alert.success.message',\n        errorTitle: 'media.edit.alert.error',\n        executeGet: false,\n        params: $state.params\n      }\n    );\n    this.api = api;\n    this.state = $state;\n    this.filter = $filter;\n    this.authorityService = authorityService;\n    this.translateService = translateService;\n    this.entity={items:[]};\n    this._load();\n    //this.autoEdit();\n  }\n\n  autoEdit(){\n    this.createRating();\n  }\n\n  expressionCountryZone(item) {\n    return item.id + ' - ' + item.description;\n  }\n\n  expression(item) {\n    return item.id;\n  }\n\n  condition(item,query) {\n    if (query == null){\n      query = \"\"\n    }\n    return item.id.indexOf(query.toUpperCase()) > -1 || item.description.indexOf(query.toUpperCase()) > -1;\n  }\n\n  createParams(rating){\n    if(rating.country){\n      rating.paramClasification = {\n        'ratingDetails':rating.country.id,\n        'type':'C'};\n      rating.paramGenre = {\n        'ratingDetails':rating.country.id,\n        'type':'G'};\n      rating.paramDisclaimer = {\n        'ratingDetails':rating.country.id,\n        'type':'D'};\n    }\n  }\n\n  changeCountry(rating,item){\n    if(rating.country&&item){\n      if(rating.country.id===item.id){\n        return;\n      }\n    }\n    rating.clasification = undefined;\n    rating.genre = undefined;\n    rating.disclaimer = [];\n    rating.plainDisclaimer = undefined;\n\n    if(!item){\n      return;\n    }\n    if(!rating.paramClasification&&!rating.paramGenre&&!rating.paramDisclaimer){\n      rating.paramClasification = {\n        'ratingDetails':item.id,\n        'type':'C'};\n      rating.paramGenre = {\n        'ratingDetails':item.id,\n        'type':'G'};\n      rating.paramDisclaimer = {\n        'ratingDetails':item.id,\n        'type':'D'};\n      return;\n    }\n    rating.paramClasification.ratingDetails = item.id;\n    rating.paramGenre.ratingDetails = item.id;\n    rating.paramDisclaimer.ratingDetails = item.id;\n  }\n\n  deleteRating(rating){\n    // Primero borramos el registro pedido\n    var index = this.entity.items.indexOf(rating);\n    if (index > -1) {\n      this.entity.items.splice(index, 1);\n    }\n  }\n\n  createRating(){\n    let ratingToInsert = {\n      country: undefined,\n      clasification: undefined,\n      genre: undefined,\n      disclaimer: undefined,\n      originCountry: undefined,\n      edited: undefined,\n      provisory: undefined,\n      comments:undefined,\n      queryCountries:'',\n      queryClasification:'',\n      queryGenre:''\n    };\n    this.entity.items.push(ratingToInsert);\n  }\n\n  setParamsDisclaimer(rating){\n    this.state.params.ratingDetails = rating.country.id;\n    this.state.params.type='D';\n  }\n\n  _load(){\n    this.tabla = [{label:'Id',key:'id'},{label:'Description',key:'description'}];\n    this.ratingsEdit = {value:false};\n    this.ratingsEditShow = {value:true};\n    this.param = {ratingDetails:''};\n    this.actions = [\n      {\n        roles:'MMMU,MMRR',\n        tooltip: this.translateService.translate('tooltip.create'),\n        icon: 'plus',\n        action: () => {this.createRating();},\n        show: {value:true}\n      }\n    ];\n  }\n\n  saveRatings(form,nextStep){\n    if(this.validateFieldRatings()){\n      this.entity.items.forEach(it => {\n        if(it.disclaimer){\n          let id = it.disclaimer.map(mp => mp.id).join();\n          it.disclaimer = {id: id, description:''};\n        }\n      });\n      this.cleanFieldSelected();\n      if(nextStep){\n        this.saveAndNextStepWithCallback(form,()=>{this.get();})\n      }else{\n        this.saveAndExit(form);\n      }\n    }else{\n      this.alertService.error({\n        title: this.translate('ratings.edit.alert.error'),\n        message: this.translate('ratings.med.search.result.tabs.ratings.message')\n      });\n    }\n  }\n\n  cleanFieldSelected(){\n    this.entity.items.forEach(it => {\n      delete it.queryCountries;\n      delete it.queryClasification;\n      delete it.queryGenre;\n      delete it.paramClasification;\n      delete it.paramGenre;\n      delete it.paramDisclaimer;\n      delete it.disclaimers;\n      if(!it.disclaimer){\n        it.disclaimer = null;\n      }else if (it.disclaimer.id ===''){\n        it.disclaimer = null;\n      }\n    });\n  }\n\n  validateFieldRatings(){\n    let valid = true;\n    if(!this.entity.items){\n      return true;\n    }\n    this.entity.items.forEach(\n      it => {\n        if(it.country === undefined || it.clasification === undefined ||\n          it.country === null || it.clasification === null){\n          valid = false;\n        }\n      });\n    return valid;\n  }\n\n  get(){\n    super\n      .get()\n      .$promise\n      .then((response) => {\n        this.entity = response;\n        if(this.entity.items.length > 0){\n          this.entity.items.forEach(\n            it => {\n              if(it.originCountry === null){\n                it.originCountry = undefined;\n              }\n              if(it.edited === null){\n                it.edited=undefined;\n              }\n              if(it.provisory === null){\n                it.provisory = undefined;\n              }\n              if(it.disclaimer !== null){\n                it.plainDisclaimer = it.disclaimer.id;\n                it.disclaimer = it.disclaimer.id.split(',').map(mp => { return {id: mp};});\n              }\n            }\n          );\n        }\n      });\n  }\n  \n}\n"],"sourceRoot":"/source/"}